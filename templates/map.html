<script type="text/javascript"
  src="http://maps.googleapis.com/maps/api/js?sensor=false">
</script>

<script type="text/javascript">

    function initialize() {

    //var myLatlng = new google.maps.LatLng(25.04195,121.519028);

    var mapOptions = {
        //center: myLatlng,
        zoom: 12,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        mapTypeControl: true,
        mapTypeControlOptions: {
          style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        },
        zoomControl: true,
        zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL
        }
    };

    var map = new google.maps.Map(document.getElementById("map_canvas"),mapOptions);
    var bounds = new google.maps.LatLngBounds();
/*
    var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: 'Hello World!'
    });
*/

        {% for mData in contents %}
            var lat = "{{mData.latitude}}";
            var lng = "{{mData.longitude}}";
            var name = "{{mData.name}}";
            var category = "{{mData.category}}";
            var LatLng = new google.maps.LatLng(lat, lng);
            addSite(map,lat,lng,name,category);
            bounds.extend(LatLng);
        {% endfor %}
        map.fitBounds(bounds);

    }

google.maps.event.addDomListener(window, 'load', initialize);

function addSite(map, lat, lng, name, category) {
    var pt = new google.maps.LatLng(lat,lng);

    var marker = new google.maps.Marker({
        position: pt,
        map: map,
        title: name
    });

    attachSecretMessage(marker, name, category, lat, lng);
}

var prev_infowindow = null;
function attachSecretMessage(marker, name,category,lat,lng) {
  var infowindow = new google.maps.InfoWindow({
    content:
            "景點名稱：" + name
    + "<br />景點類型：" + category
    + "<br />緯度：" + lat
    + "<br />經度：" + lng
  });
  google.maps.event.addListener(marker, 'click', function() {
    if (prev_infowindow != null) prev_infowindow.close();
    prev_infowindow = infowindow;
    infowindow.open(marker.get('map'), marker);
  });
}

</script>